import{d as A}from"./consumer-B-5sexIM.js";import{P as E}from"./index-CiZ7u30k.js";import{d as V,r as m,K as z,o as n,L as K,a as c,c as l,u as x,T as k,ab as w,P as O,S as d}from"./@vue-ygbFPFRc.js";import{d as j}from"./index-RwF53efZ.js";import"./element-plus-Dexv8m38.js";import"./@element-plus-X4lX9UBP.js";import"./lodash-es-C1lm3Iro.js";import"./dayjs-Bnps4p3p.js";import"./@popperjs-D_chPuIy.js";import"./async-validator-9PlIezaS.js";import"./@ctrl-r5W6hzzQ.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./nprogress-UhqZPtFR.js";import"./vue-router-Cg6aTb_d.js";import"./pinia-CfRoOCaL.js";import"./axios-DIsA03vz.js";import"./lodash-CMKdTQec.js";import"./@vueuse-yz9uDhpq.js";import"./css-color-function-rr4n3v1N.js";import"./balanced-match-BdS7OldZ.js";import"./color-DYO1E7y4.js";import"./clone-Ddk2tjDh.js";import"./color-convert-DsNsD289.js";import"./color-name-Dju3oUBS.js";import"./color-string-pUQDDJII.js";import"./ms-CzQ2E3wO.js";import"./vue-clipboard3-BWi338pc.js";import"./clipboard-7pJsftR6.js";import"./echarts-CXZcVnUo.js";import"./tslib-BDyQ-Jie.js";import"./zrender-DO4NV0px.js";import"./highlight.js-BLB-XFKK.js";import"./@highlightjs-DS9t1Xn3.js";const q={class:"log-panel"},G={class:"log-timeline"},H={key:0,class:"empty"},J={key:1},M={class:"timeline-content"},Q={class:"timeline-header"},U={class:"timeline-time"},W={key:0,class:"timeline-stage"},X={class:"timeline-lines"},Y=V({__name:"follow-log-popup",props:{customerId:{}},emits:["close"],setup(C,{expose:$,emit:b}){const N=C,B=b,f=m(),_=m("all"),a=m([]),F=async()=>{try{const t=await A({customer_id:N.customerId,page_no:1,page_size:50});a.value=(t==null?void 0:t.lists)||[]}catch(t){console.error(t)}},p=t=>{const s=Number(t.record_type||0);if(s)return s;const o=t.content||"";return o.includes("新增平台咨询为")?2:o.includes("客户录入")?3:o.includes("追加派单医院")?4:1},g=t=>p(t)===2,S=t=>p(t)===3,h=t=>p(t)===4,v=t=>g(t)||S(t)||h(t)?"":Number(t.stage||0)>10?t.stage_desc||"":t.stage?`阶段${t.stage}：${t.stage_desc||""}`:t.stage_desc||"",I=t=>t.operator_name||t.operator_type_desc||"系统",y=t=>t?t.split(/\n/).map(s=>s.trim()).filter(Boolean):[],P=t=>{const s=["dynamic","consult","all"].includes(_.value);if(s&&h(t))return y(t.content||"");if(s&&!g(t)){const r=I(t),e=y(t.content||""),i=[];if(!e.length)i.push(`${r}新建一条跟进记录：【无】`);else if(e.length===1)i.push(`${r}新建一条跟进记录：【${e[0]}】`);else{i.push(`${r}新建一条跟进记录：【${e[0]}`);for(let u=1;u<e.length-1;u++)i.push(e[u]);i.push(`${e[e.length-1]}】`)}const R=Number(t.consult_selected||0),L=t.consult_hospitals||"";return R&&L&&i.push(`所推咨询：${L}`),i}const o=[];return t.content&&t.content.split(/\n/).forEach(r=>{const e=r.trim();e&&o.push(e)}),o},T=()=>{var t;_.value="all",(t=f.value)==null||t.open(),F()},D=()=>{a.value=[],B("close")};return $({open:T}),(t,s)=>(n(),z(E,{ref_key:"popupRef",ref:f,title:"跟进记录",async:!0,width:"900px","confirm-button-text":!1,"cancel-button-text":!1,onClose:D},{default:K(()=>[c("div",q,[c("div",G,[x(a).length?(n(),l("div",J,[(n(!0),l(k,null,w(x(a),o=>(n(),l("div",{key:o.id,class:"timeline-item"},[s[0]||(s[0]=c("div",{class:"timeline-dot"},null,-1)),c("div",M,[c("div",Q,[c("div",U,d(o.create_time),1),v(o)?(n(),l("div",W,d(v(o)),1)):O("",!0)]),c("div",X,[(n(!0),l(k,null,w(P(o),(r,e)=>(n(),l("div",{key:e,class:"line"},d(r),1))),128))])])]))),128))])):(n(),l("div",H,"暂无跟进记录"))])])]),_:1},512))}}),Pt=j(Y,[["__scopeId","data-v-557694e8"]]);export{Pt as default};
