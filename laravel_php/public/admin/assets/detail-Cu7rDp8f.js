import{N as _e,I as ce,T as de,U as fe,R as me,i as ye,V as we,W as ge,X as be,G as ve,Y as ke}from"./element-plus-Dexv8m38.js";import{b as he,d as Ce,a as Re}from"./consumer-B-5sexIM.js";import Pe from"./follow-popup-B11DM2t4.js";import{_ as Te}from"./assign-popup.vue_vue_type_script_setup_true_lang-DEWeLF_i.js";import{_ as xe}from"./transfer-popup.vue_vue_type_script_setup_true_lang-CSvaxHze.js";import{_ as Ee}from"./assist-popup.vue_vue_type_script_setup_true_lang-BeRrudPv.js";import{_ as Be}from"./assign-blogger-popup.vue_vue_type_script_setup_true_lang-BE3vf3QI.js";import{u as Se}from"./vue-router-Cg6aTb_d.js";import{d as W,b as $e,r as c,a0 as De,l as Fe,w as Ve,at as Ae,c as y,o as i,U as l,K as _,P as d,L as t,R as a,S as u,u as o,a as f,T as H,ab as K,O as Oe,M as R,i as Ie,n as g}from"./@vue-ygbFPFRc.js";import{d as Ne}from"./index-RwF53efZ.js";import"./@element-plus-X4lX9UBP.js";import"./lodash-es-C1lm3Iro.js";import"./dayjs-Bnps4p3p.js";import"./@popperjs-D_chPuIy.js";import"./async-validator-9PlIezaS.js";import"./@ctrl-r5W6hzzQ.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./hospital-BeBKXzQO.js";import"./employee-CJ8eLApb.js";import"./index-CiZ7u30k.js";import"./nprogress-UhqZPtFR.js";import"./pinia-CfRoOCaL.js";import"./axios-DIsA03vz.js";import"./lodash-CMKdTQec.js";import"./@vueuse-yz9uDhpq.js";import"./css-color-function-rr4n3v1N.js";import"./balanced-match-BdS7OldZ.js";import"./color-DYO1E7y4.js";import"./clone-Ddk2tjDh.js";import"./color-convert-DsNsD289.js";import"./color-name-Dju3oUBS.js";import"./color-string-pUQDDJII.js";import"./ms-CzQ2E3wO.js";import"./vue-clipboard3-BWi338pc.js";import"./clipboard-7pJsftR6.js";import"./echarts-CXZcVnUo.js";import"./tslib-BDyQ-Jie.js";import"./zrender-DO4NV0px.js";import"./highlight.js-BLB-XFKK.js";import"./@highlightjs-DS9t1Xn3.js";const ze={key:1},Le={key:0,class:"whitespace-pre-line"},je={key:1},Ue={class:"mt-4 flex flex-wrap gap-2"},qe={class:"flex items-center justify-between"},Ge={class:"flex items-center justify-between mb-2"},Me={class:"ml-2 font-bold"},He={key:0,class:"text-gray-700 mb-2 whitespace-pre-line"},Ke={class:"whitespace-pre-line"},We=W({name:"consumerDetail"}),Xe=W({...We,setup(Ye){const x=Se(),m=$e(()=>Number(x.query.id)),E=c(),r=De({}),B=c([]),b=c("all"),I=c([]),N=c([]),S=c(!1),$=c(!1),D=c(!1),F=c(!1),V=c(!1),z=c(),L=c(),j=c(),U=c(),q=c(),w=async()=>{try{const e=await he({customer_id:m.value});Object.assign(r,e)}catch(e){console.error(e)}},A=async()=>{try{const e=await Ce({customer_id:m.value,type:b.value==="all"?"":b.value});B.value=(e==null?void 0:e.lists)||[]}catch(e){console.error(e)}},X=async()=>{try{const e=await Re();I.value=e.stage_options||[],N.value=e.customer_type_options||[]}catch(e){console.error(e)}},Y=e=>e===6?"success":e===5||e===51?"warning":e===4?"info":"",J=e=>e===2?"success":e===3?"danger":"",Q=e=>e==="urgent"?"remind-urgent":e==="near"?"remind-near":e==="normal"?"remind-normal":"",Z=e=>e===1?"primary":e===2?"success":e===3?"warning":"",ee=e=>!!(e.customer_type_desc||e.group_chat||e.consult_text||e.follow_way_desc||e.next_follow_time),te=()=>{S.value=!0,g(()=>{var e;(e=z.value)==null||e.open("follow")})},oe=()=>{$.value=!0,g(()=>{var e;(e=L.value)==null||e.open()})},se=()=>{D.value=!0,g(()=>{var e;(e=j.value)==null||e.open()})},le=()=>{F.value=!0,g(()=>{var e;(e=U.value)==null||e.open()})},ae=()=>{V.value=!0,g(()=>{var e;(e=q.value)==null||e.open()})},ne=async()=>{await w(),await A()},G=async()=>{var s,P;if(x.query.view!=="follow")return;await g();const e=((s=E.value)==null?void 0:s.$el)||E.value;(P=e==null?void 0:e.scrollIntoView)==null||P.call(e,{behavior:"smooth",block:"start"})};return X(),w(),A(),Fe(()=>{G()}),Ve(()=>x.query.view,()=>{G()}),(e,s)=>{const P=_e,v=ce,p=fe,O=de,k=me,h=ye,T=ke,re=ve,ue=ge,ie=we,pe=be,C=Ae("perms");return i(),y("div",null,[l(v,{class:"!border-none",shadow:"never"},{default:t(()=>[l(P,{content:"客户详情",onBack:s[0]||(s[0]=n=>e.$router.back())})]),_:1}),l(v,{class:"mt-4 !border-none",header:"基本信息",shadow:"never"},{default:t(()=>[l(O,{column:3,border:""},{default:t(()=>[l(p,{label:"手机号"},{default:t(()=>[a(u(o(r).mobile||"-"),1)]),_:1}),l(p,{label:"微信号"},{default:t(()=>[a(u(o(r).wechat||"-"),1)]),_:1}),l(p,{label:"客户姓名"},{default:t(()=>[a(u(o(r).real_name||o(r).nickname||"-"),1)]),_:1}),l(p,{label:"客户来源"},{default:t(()=>[a(u(o(r).source_desc||"-"),1)]),_:1}),l(p,{label:"来源账号"},{default:t(()=>[a(u(o(r).source_account||"-"),1)]),_:1}),l(p,{label:"客户地区"},{default:t(()=>[a(u(o(r).region||"-"),1)]),_:1}),l(p,{label:"意向项目"},{default:t(()=>[a(u(o(r).project_items_desc||"-"),1)]),_:1}),l(p,{label:"创建时间"},{default:t(()=>[a(u(o(r).create_time||"-"),1)]),_:1}),l(p,{label:"备注",span:3},{default:t(()=>[a(u(o(r).remark||"-"),1)]),_:1})]),_:1})]),_:1}),l(v,{class:"mt-4 !border-none",header:"跟进信息",shadow:"never"},{default:t(()=>[l(O,{column:3,border:""},{default:t(()=>[l(p,{label:"当前阶段"},{default:t(()=>[l(k,{type:Y(o(r).stage)},{default:t(()=>[a(u(o(r).stage_desc||"-"),1)]),_:1},8,["type"])]),_:1}),l(p,{label:"状态"},{default:t(()=>[l(k,{type:J(o(r).status)},{default:t(()=>[a(u(o(r).status_desc||"-"),1)]),_:1},8,["type"])]),_:1}),l(p,{label:"客户类型"},{default:t(()=>[a(u(o(r).customer_type_desc||"未分类"),1)]),_:1}),l(p,{label:"主跟进人"},{default:t(()=>[a(u(o(r).owner_name||"-"),1)]),_:1}),l(p,{label:"协助员"},{default:t(()=>{var n;return[(n=o(r).assist_list)!=null&&n.length?(i(!0),y(H,{key:0},K(o(r).assist_list,M=>(i(),_(k,{key:M.id,size:"small",class:"mr-1"},{default:t(()=>[a(u(M.name),1)]),_:2},1024))),128)):(i(),y("span",ze,"-"))]}),_:1}),l(p,{label:"对接博主"},{default:t(()=>[a(u(o(r).blogger_name||"-"),1)]),_:1}),l(p,{label:"最后跟进"},{default:t(()=>[a(u(o(r).last_follow_time||"-"),1)]),_:1}),l(p,{label:"所在群聊"},{default:t(()=>[o(r).group_chat?(i(),y("span",Le,u(o(r).group_chat),1)):(i(),y("span",je,"-"))]),_:1}),l(p,{label:"下次跟进"},{default:t(()=>[f("span",{class:Oe(Q(o(r).remind_status))},u(o(r).next_follow_time||"-"),3)]),_:1})]),_:1}),f("div",Ue,[R((i(),_(h,{type:"warning",class:"btn-follow",onClick:te},{default:t(()=>s[7]||(s[7]=[a(" 添加跟进 ")])),_:1})),[[C,["user.user/followAdd"]]]),R((i(),_(h,{type:"warning",onClick:ae},{default:t(()=>s[8]||(s[8]=[a(" 对接咨询 ")])),_:1})),[[C,["user.user/assignBlogger"]]]),o(r).owner_employee_id?R((i(),_(h,{key:0,onClick:se},{default:t(()=>s[9]||(s[9]=[a(" 转移客户 ")])),_:1})),[[C,["user.user/transfer"]]]):R((i(),_(h,{key:1,onClick:oe},{default:t(()=>s[10]||(s[10]=[a(" 分配跟进 ")])),_:1})),[[C,["user.user/assign"]]]),R((i(),_(h,{onClick:le},{default:t(()=>s[11]||(s[11]=[a(" 指派协助 ")])),_:1})),[[C,["user.user/addAssist"]]])])]),_:1}),l(v,{ref_key:"followSectionRef",ref:E,class:"mt-4 !border-none",shadow:"never"},{header:t(()=>[f("div",qe,[s[16]||(s[16]=f("span",null,"跟进记录",-1)),l(re,{modelValue:o(b),"onUpdate:modelValue":s[1]||(s[1]=n=>Ie(b)?b.value=n:null),size:"small",onChange:A},{default:t(()=>[l(T,{label:"all"},{default:t(()=>s[12]||(s[12]=[a("全部")])),_:1}),l(T,{label:"sales"},{default:t(()=>s[13]||(s[13]=[a("业务员")])),_:1}),l(T,{label:"blogger"},{default:t(()=>s[14]||(s[14]=[a("博主")])),_:1}),l(T,{label:"admin"},{default:t(()=>s[15]||(s[15]=[a("管理员")])),_:1})]),_:1},8,["modelValue"])])]),default:t(()=>[l(ie,null,{default:t(()=>[(i(!0),y(H,null,K(o(B),n=>(i(),_(ue,{key:n.id,timestamp:n.create_time,placement:"top"},{default:t(()=>[l(v,null,{default:t(()=>[f("div",Ge,[f("span",null,[l(k,{size:"small",type:Z(n.operator_type)},{default:t(()=>[a(u(n.operator_type_desc),1)]),_:2},1032,["type"]),f("span",Me,u(n.operator_name||"-"),1)]),l(k,null,{default:t(()=>[a(u(n.stage_desc),1)]),_:2},1024)]),n.content?(i(),y("div",He,u(n.content),1)):d("",!0),ee(n)?(i(),_(O,{key:1,column:2,size:"small",border:""},{default:t(()=>[n.customer_type_desc?(i(),_(p,{key:0,label:"客户类型"},{default:t(()=>[a(u(n.customer_type_desc),1)]),_:2},1024)):d("",!0),n.group_chat?(i(),_(p,{key:1,label:"所在群聊"},{default:t(()=>[f("span",Ke,u(n.group_chat),1)]),_:2},1024)):d("",!0),n.consult_text?(i(),_(p,{key:2,label:"所推咨询"},{default:t(()=>[a(u(n.consult_text),1)]),_:2},1024)):d("",!0),n.follow_way_desc?(i(),_(p,{key:3,label:"跟进方式"},{default:t(()=>[a(u(n.follow_way_desc),1)]),_:2},1024)):d("",!0),n.next_follow_time?(i(),_(p,{key:4,label:"下次跟进"},{default:t(()=>[a(u(n.next_follow_time),1)]),_:2},1024)):d("",!0)]),_:2},1024)):d("",!0)]),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1}),o(B).length?d("",!0):(i(),_(pe,{key:0,description:"暂无跟进记录"}))]),_:1},512),o(S)?(i(),_(Pe,{key:0,ref_key:"followPopupRef",ref:z,"customer-id":o(m),"relation-type":o(r).relation_type||"","stage-options":o(I),"customer-type-options":o(N),onSuccess:ne,onClose:s[2]||(s[2]=n=>S.value=!1)},null,8,["customer-id","relation-type","stage-options","customer-type-options"])):d("",!0),o($)?(i(),_(Te,{key:1,ref_key:"assignPopupRef",ref:L,"customer-id":o(m),onSuccess:w,onClose:s[3]||(s[3]=n=>$.value=!1)},null,8,["customer-id"])):d("",!0),o(D)?(i(),_(xe,{key:2,ref_key:"transferPopupRef",ref:j,"customer-id":o(m),onSuccess:w,onClose:s[4]||(s[4]=n=>D.value=!1)},null,8,["customer-id"])):d("",!0),o(F)?(i(),_(Ee,{key:3,ref_key:"assistPopupRef",ref:U,"customer-id":o(m),"owner-employee-id":o(r).owner_employee_id||0,onSuccess:w,onClose:s[5]||(s[5]=n=>F.value=!1)},null,8,["customer-id","owner-employee-id"])):d("",!0),o(V)?(i(),_(Be,{key:4,ref_key:"assignBloggerPopupRef",ref:q,"customer-id":o(m),onSuccess:w,onClose:s[6]||(s[6]=n=>V.value=!1)},null,8,["customer-id"])):d("",!0)])}}}),It=Ne(Xe,[["__scopeId","data-v-44124722"]]);export{It as default};
