import{P as Y}from"./index-CiZ7u30k.js";import{D as ee,B as le,O as oe,P as ae,C as re,G as te,H as se,Z as ne,_ as ue,F as pe,E as ie}from"./element-plus-Dexv8m38.js";import{d as R,r as v,b as h,a0 as de,w as y,K as g,o as i,L as s,U as t,u as r,c as _,T as m,ab as f,R as V,i as ce,S as O,Z as _e,a as me}from"./@vue-ygbFPFRc.js";import{r as fe}from"./consumer-B-5sexIM.js";import{p as be}from"./project-CreSpfIK.js";import{h as ve}from"./hospital-BeBKXzQO.js";import{r as ge}from"./region-china-BCkRz1Fn.js";const Ve={class:"flex gap-2 w-full"},he=R({name:"consumerReport"}),Oe=R({...he,emits:["success","close"],setup(ye,{expose:S,emit:A}){const x=A,w=v(),E=v(),F=[{value:1,label:"小红书"},{value:2,label:"抖音"},{value:6,label:"快手"},{value:3,label:"微信"},{value:7,label:"发帖引流"},{value:8,label:"凯文抖音博主号"},{value:9,label:"七七团队素人账号"},{value:10,label:"不凡团队素人账号"},{value:4,label:"朋友介绍"},{value:5,label:"其他"}],H=[{value:0,label:"未设置"},{value:1,label:"1天后联系"},{value:2,label:"2天后联系"},{value:3,label:"3天后联系"},{value:4,label:"5天后联系"},{value:5,label:"7天后联系"}],C=v([]),d=v([]),B=h(()=>ge.map(a=>({label:a.label,value:a.value,children:(a.children||[]).map(l=>({label:l.label,value:l.value,children:(l.children||[]).map(u=>({label:u.label,value:u.value}))}))}))),b=v([]),e=de({source:void 0,source_account:"",name:"",mobile:"",gender:0,wechat:"",region_province:"",region_city:"",region_district:"",region_address:"",project_ids:[],hospital_ids:[],hospital:"",report_province:"",report_city:"",follow_status:0,remark:""}),M={name:[{required:!0,message:"请输入客户姓名",trigger:"blur"}],mobile:[{required:!0,message:"请输入联系号码",trigger:"blur"}],wechat:[{required:!0,message:"请输入微信号",trigger:"blur"}]},P=()=>{e.source=void 0,e.source_account="",e.name="",e.mobile="",e.gender=0,e.wechat="",e.region_province="",e.region_city="",e.region_district="",e.region_address="",e.project_ids=[],e.hospital_ids=[],e.hospital="",e.report_province="",e.report_city="",e.follow_status=0,e.remark="",b.value=[]},D=()=>{var a;P(),q(),(a=w.value)==null||a.open()},q=async()=>{const a=await be();C.value=a||[]},G=async()=>{if(!e.project_ids.length){d.value=[],e.hospital_ids=[],e.report_province="",e.report_city="";return}const a=await ve({project_ids:e.project_ids});d.value=a||[],d.value.length||(e.hospital_ids=[],e.report_province="",e.report_city="")},I=h(()=>{const a=new Map;return d.value.forEach(l=>{l.province&&a.set(l.province,!0)}),Array.from(a.keys())}),L=h(()=>{const a=new Map;return d.value.forEach(l=>{e.report_province&&l.province!==e.report_province||l.city&&a.set(l.city,!0)}),Array.from(a.keys())}),N=h(()=>{const a=d.value.filter(n=>!(e.report_province&&n.province!==e.report_province||e.report_city&&n.city!==e.report_city));if(!e.hospital_ids.length)return a;const l=d.value.filter(n=>e.hospital_ids.includes(n.id)),u=new Map;return a.forEach(n=>u.set(n.id,n)),l.forEach(n=>{u.has(n.id)||u.set(n.id,n)}),Array.from(u.values())}),T=a=>{const l=Array.isArray(a)?a:[],u=d.value.filter(n=>l.includes(n.id));e.hospital=u.map(n=>n.name).join("、")},Z=(a,l)=>{const u=new Set(e.hospital_ids);l?u.add(a):u.delete(a),e.hospital_ids=Array.from(u)};y(()=>e.project_ids.slice(),async()=>{e.hospital_ids=[],e.hospital="",e.report_province="",e.report_city="",await G()},{deep:!0}),y(()=>e.report_province,()=>{e.report_city=""}),y(()=>e.hospital_ids.slice(),a=>{T(a)}),y(()=>b.value,a=>{e.region_province=(a==null?void 0:a[0])||"",e.region_city=(a==null?void 0:a[1])||"",e.region_district=(a==null?void 0:a[2])||""});const $=async()=>{var u;await((u=E.value)==null?void 0:u.validate());const a=d.value.filter(n=>e.hospital_ids.includes(n.id)),l={...e,hospital:a.length?a.map(n=>n.name).join("、"):e.hospital||""};delete l.hospital_ids,await fe(l),ie.success("报备成功"),x("success"),U()},U=()=>{var a;(a=w.value)==null||a.close(),x("close")};return S({open:D}),(a,l)=>{const u=ae,n=oe,p=le,c=re,k=se,K=te,z=ne,j=pe,J=ue,Q=ee,W=Y;return i(),g(W,{ref_key:"popupRef",ref:w,title:"客户报备",async:!0,width:"640px",onConfirm:$,onClose:U},{default:s(()=>[t(Q,{ref_key:"formRef",ref:E,model:r(e),rules:M,"label-width":"110px"},{default:s(()=>[t(p,{label:"客户来源",prop:"source"},{default:s(()=>[t(n,{modelValue:r(e).source,"onUpdate:modelValue":l[0]||(l[0]=o=>r(e).source=o),placeholder:"请选择客户来源",clearable:""},{default:s(()=>[(i(),_(m,null,f(F,o=>t(u,{key:o.value,label:o.label,value:o.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"来源账号",prop:"source_account"},{default:s(()=>[t(c,{modelValue:r(e).source_account,"onUpdate:modelValue":l[1]||(l[1]=o=>r(e).source_account=o),placeholder:"请输入来源账号（选填）"},null,8,["modelValue"])]),_:1}),t(p,{label:"客户姓名",prop:"name"},{default:s(()=>[t(c,{modelValue:r(e).name,"onUpdate:modelValue":l[2]||(l[2]=o=>r(e).name=o),placeholder:"请输入客户姓名",maxlength:"50"},null,8,["modelValue"])]),_:1}),t(p,{label:"联系号码",prop:"mobile"},{default:s(()=>[t(c,{modelValue:r(e).mobile,"onUpdate:modelValue":l[3]||(l[3]=o=>r(e).mobile=o),placeholder:"请输入联系号码",maxlength:"32"},null,8,["modelValue"])]),_:1}),t(p,{label:"性别",prop:"gender"},{default:s(()=>[t(K,{modelValue:r(e).gender,"onUpdate:modelValue":l[4]||(l[4]=o=>r(e).gender=o)},{default:s(()=>[t(k,{value:0},{default:s(()=>l[15]||(l[15]=[V("未知")])),_:1}),t(k,{value:1},{default:s(()=>l[16]||(l[16]=[V("男")])),_:1}),t(k,{value:2},{default:s(()=>l[17]||(l[17]=[V("女")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"微信号",prop:"wechat"},{default:s(()=>[t(c,{modelValue:r(e).wechat,"onUpdate:modelValue":l[5]||(l[5]=o=>r(e).wechat=o),placeholder:"请输入微信号",maxlength:"50"},null,8,["modelValue"])]),_:1}),t(p,{label:"客户地区",prop:"region_province"},{default:s(()=>[t(z,{modelValue:r(b),"onUpdate:modelValue":l[6]||(l[6]=o=>ce(b)?b.value=o:null),options:r(B),props:{checkStrictly:!0,expandTrigger:"hover"},clearable:"",filterable:"",placeholder:"请选择省/市/区（选填）",class:"w-full"},null,8,["modelValue","options"])]),_:1}),t(p,{label:"详细地址",prop:"region_address"},{default:s(()=>[t(c,{modelValue:r(e).region_address,"onUpdate:modelValue":l[7]||(l[7]=o=>r(e).region_address=o),placeholder:"请输入详细地址（选填）",maxlength:"255"},null,8,["modelValue"])]),_:1}),t(p,{label:"报单项目",prop:"project_ids"},{default:s(()=>[t(J,{modelValue:r(e).project_ids,"onUpdate:modelValue":l[8]||(l[8]=o=>r(e).project_ids=o)},{default:s(()=>[(i(!0),_(m,null,f(r(C),o=>(i(),g(j,{key:o.id,label:o.id},{default:s(()=>[V(O(o.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"报单医院",prop:"hospital_ids"},{default:s(()=>[t(n,{modelValue:r(e).hospital_ids,"onUpdate:modelValue":l[10]||(l[10]=o=>r(e).hospital_ids=o),placeholder:"请选择报单医院（选填）",filterable:"",clearable:"",multiple:"",class:"w-full"},{default:s(()=>[(i(!0),_(m,null,f(r(N),o=>(i(),g(u,{key:o.id,label:o.name,value:o.id},{default:s(()=>[t(j,{"model-value":r(e).hospital_ids.includes(o.id),onClick:l[9]||(l[9]=_e(()=>{},["stop"])),onChange:X=>Z(o.id,X)},{default:s(()=>[V(O(o.name),1)]),_:2},1032,["model-value","onChange"])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"报单地区",prop:"report_province"},{default:s(()=>[me("div",Ve,[t(n,{modelValue:r(e).report_province,"onUpdate:modelValue":l[11]||(l[11]=o=>r(e).report_province=o),placeholder:"请选择省",clearable:"",class:"flex-1"},{default:s(()=>[(i(!0),_(m,null,f(r(I),o=>(i(),g(u,{key:o,label:o,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(n,{modelValue:r(e).report_city,"onUpdate:modelValue":l[12]||(l[12]=o=>r(e).report_city=o),placeholder:"请选择市",clearable:"",class:"flex-1",disabled:!r(e).report_province},{default:s(()=>[(i(!0),_(m,null,f(r(L),o=>(i(),g(u,{key:o,label:o,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])])]),_:1}),t(p,{label:"跟进状态",prop:"follow_status"},{default:s(()=>[t(n,{modelValue:r(e).follow_status,"onUpdate:modelValue":l[13]||(l[13]=o=>r(e).follow_status=o),placeholder:"请选择跟进状态"},{default:s(()=>[(i(),_(m,null,f(H,o=>t(u,{key:o.value,label:o.label,value:o.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"备注",prop:"remark"},{default:s(()=>[t(c,{modelValue:r(e).remark,"onUpdate:modelValue":l[14]||(l[14]=o=>r(e).remark=o),type:"textarea",rows:3,placeholder:"请输入备注（选填）",maxlength:"500"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},512)}}});export{Oe as _};
