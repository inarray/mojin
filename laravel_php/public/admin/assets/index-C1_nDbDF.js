import{D as ve,B as be,C as ge,O as ke,P as we,i as Ce,I as xe,d as Ee,L as Ve,M as $e,q as Te,R as Se,K as he,S as Re,a as S,E as k}from"./element-plus-Dexv8m38.js";import{_ as Le}from"./index.vue_vue_type_script_setup_true_lang-D_09Ie3h.js";import{_ as Be}from"./index.vue_vue_type_script_setup_true_lang-ChJKyYj5.js";import{_ as Ue}from"./index.vue_vue_type_script_setup_true_lang-k5looPxV.js";import{d as W,a0 as q,r as c,l as De,at as Pe,c as h,o as r,U as t,K as d,P as j,L as n,u as o,a9 as Me,T as A,ab as G,R as i,a as R,M as y,S as L,i as H,n as B}from"./@vue-ygbFPFRc.js";import{A as Oe,O as ze}from"./@element-plus-X4lX9UBP.js";import{g as J,c as Fe,r as Ie,d as Ke}from"./employee-CJ8eLApb.js";import{r as X}from"./index-RwF53efZ.js";import{u as Ne}from"./usePaging-B2jDzebD.js";import{_ as qe}from"./edit.vue_vue_type_script_setup_true_name_employeeEdit_lang-ha_KwYLu.js";import{_ as je}from"./password.vue_vue_type_script_setup_true_name_employeePassword_lang-vQzu94K_.js";import"./lodash-es-C1lm3Iro.js";import"./dayjs-Bnps4p3p.js";import"./@popperjs-D_chPuIy.js";import"./async-validator-9PlIezaS.js";import"./@ctrl-r5W6hzzQ.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./index-CiZ7u30k.js";import"./nprogress-UhqZPtFR.js";import"./vue-router-Cg6aTb_d.js";import"./pinia-CfRoOCaL.js";import"./axios-DIsA03vz.js";import"./lodash-CMKdTQec.js";import"./@vueuse-yz9uDhpq.js";import"./css-color-function-rr4n3v1N.js";import"./balanced-match-BdS7OldZ.js";import"./color-DYO1E7y4.js";import"./clone-Ddk2tjDh.js";import"./color-convert-DsNsD289.js";import"./color-name-Dju3oUBS.js";import"./color-string-pUQDDJII.js";import"./ms-CzQ2E3wO.js";import"./vue-clipboard3-BWi338pc.js";import"./clipboard-7pJsftR6.js";import"./echarts-CXZcVnUo.js";import"./tslib-BDyQ-Jie.js";import"./zrender-DO4NV0px.js";import"./highlight.js-BLB-XFKK.js";import"./@highlightjs-DS9t1Xn3.js";import"./picker-B75jrQ9B.js";import"./index-CbsoMyLi.js";import"./index-B6RYlZU7.js";import"./index-DABXkeGo.js";import"./index.vue_vue_type_script_setup_true_lang-Dv5KHRgf.js";import"./vuedraggable-RHgmLr3o.js";import"./vue-CQyKTslw.js";import"./sortablejs-BvvSZPRv.js";import"./department-Csnz69ah.js";import"./post-Ctu21J9T.js";import"./role-CHeEam9r.js";import"./useDictOptions-C0oZ1YZn.js";function Ae(w){return X.get({url:"/user/employee/leaveCheck",params:w})}function Q(w){return X.post({url:"/user/employee/leaveTransfer",params:w})}const Ge={class:"flex justify-between mb-4"},He={class:"flex justify-end mt-4"},Je={class:"text-sm text-tx-secondary mb-3"},Qe=W({name:"employeeList"}),Ht=W({...Qe,setup(w){const m=q({keyword:"",status:"",create_time_start:"",create_time_end:""}),U=c([]),C=c(!1),V=c(!1),v=c(!1),D=c(0),P=c([]),$=c(!1),T=c(),M=c(),u=q({from_uid:0,to_uid:"",reason:""}),{pager:b,getLists:_,resetPage:O,resetParams:Y}=Ne({fetchFun:J,params:m}),Z=async()=>{try{const l=await Fe();U.value=l}catch(l){console.error(l)}},ee=l=>({0:"未知",1:"男",2:"女"})[String(l)]||"未知",te=()=>{C.value=!0,B(()=>{var l;(l=T.value)==null||l.open("add")})},ae=l=>{C.value=!0,B(()=>{var e;(e=T.value)==null||e.open("edit",l.id)})},le=l=>{V.value=!0,B(()=>{var e;(e=M.value)==null||e.open(l.id,l.account)})},oe=async l=>{try{const e=await Ae({employee_id:l.id});if(e.need_transfer===0){await S.confirm(`确定将 ${l.real_name||l.account} 设为离职状态？`,"提示",{type:"warning"}),await Q({from_uid:l.id,reason:""}),k.success("操作成功"),_();return}u.from_uid=l.id,u.to_uid="",u.reason="",D.value=e.transfer_count||0,P.value=e.receiver_list||[],v.value=!0}catch{}},ne=async l=>{try{await S.confirm(`确定将 ${l.real_name||l.account} 恢复在职状态？`,"提示",{type:"warning"}),await Ie({id:l.id}),k.success("操作成功"),_()}catch{}},se=async l=>{try{await S.confirm(`确定删除 ${l.real_name||l.account}？删除后该账号将无法登录小程序。`,"删除确认",{type:"warning",confirmButtonText:"确定删除",confirmButtonClass:"el-button--danger"}),await Ke({id:l.id}),k.success("删除成功"),_()}catch{}},re=l=>{const e=l.real_name||l.nickname||l.account||`ID:${l.id}`,x=l.account?`(${l.account})`:"",f=l.mobile?` ${l.mobile}`:"";return`${e}${x}${f}`},ie=async()=>{if(!u.to_uid){k.warning("请选择接手业务员");return}$.value=!0;try{await Q({from_uid:u.from_uid,to_uid:Number(u.to_uid),reason:u.reason||""}),k.success("操作成功"),v.value=!1,_()}finally{$.value=!1}};return De(()=>{Z(),_()}),(l,e)=>{const x=ge,f=be,z=we,F=ke,me=Ue,p=Ce,I=ve,K=xe,N=Ee,ue=Be,de=Te,s=$e,pe=Se,ce=Ve,_e=Le,fe=Re,g=Pe("perms"),ye=he;return r(),h("div",null,[t(K,{class:"!border-none",shadow:"never"},{default:n(()=>[t(I,{ref:"formRef",class:"mb-[-16px]",model:o(m),inline:!0},{default:n(()=>[t(f,{class:"w-[280px]",label:"员工信息"},{default:n(()=>[t(x,{modelValue:o(m).keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>o(m).keyword=a),placeholder:"账号/姓名/手机号",clearable:"",onKeyup:Me(o(O),["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),t(f,{label:"状态"},{default:n(()=>[t(F,{modelValue:o(m).status,"onUpdate:modelValue":e[1]||(e[1]=a=>o(m).status=a),placeholder:"全部",clearable:""},{default:n(()=>[(r(!0),h(A,null,G(o(U),a=>(r(),d(z,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(f,{label:"创建时间"},{default:n(()=>[t(me,{startTime:o(m).create_time_start,"onUpdate:startTime":e[2]||(e[2]=a=>o(m).create_time_start=a),endTime:o(m).create_time_end,"onUpdate:endTime":e[3]||(e[3]=a=>o(m).create_time_end=a)},null,8,["startTime","endTime"])]),_:1}),t(f,null,{default:n(()=>[t(p,{type:"primary",onClick:o(O)},{default:n(()=>e[11]||(e[11]=[i("查询")])),_:1},8,["onClick"]),t(p,{onClick:o(Y)},{default:n(()=>e[12]||(e[12]=[i("重置")])),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),_:1}),t(K,{class:"!border-none mt-4",shadow:"never"},{default:n(()=>[R("div",Ge,[y((r(),d(p,{type:"primary",onClick:te},{default:n(()=>[t(N,{class:"mr-1"},{default:n(()=>[t(o(Oe))]),_:1}),e[13]||(e[13]=i(" 添加业务员 "))]),_:1})),[[g,["employee.employee/add"]]]),t(ue,{"fetch-fun":o(J),params:o(m),"page-size":o(b).size},null,8,["fetch-fun","params","page-size"])]),y((r(),d(ce,{size:"large",data:o(b).lists},{default:n(()=>[t(s,{label:"头像","min-width":"80"},{default:n(({row:a})=>[t(de,{src:a.avatar_thumb||a.avatar,size:50},{default:n(()=>[t(N,null,{default:n(()=>[t(o(ze))]),_:1})]),_:2},1032,["src"])]),_:1}),t(s,{label:"员工编号",prop:"sn","min-width":"120"}),t(s,{label:"账号",prop:"account","min-width":"120"}),t(s,{label:"真实姓名",prop:"real_name","min-width":"100"}),t(s,{label:"昵称",prop:"nickname","min-width":"100"}),t(s,{label:"手机号码",prop:"mobile","min-width":"120"}),t(s,{label:"归属部门",prop:"dept_name","min-width":"120"}),t(s,{label:"岗位",prop:"jobs_name","min-width":"120"}),t(s,{label:"角色",prop:"role_name","min-width":"120"}),t(s,{label:"性别","min-width":"80"},{default:n(({row:a})=>[i(L(ee(a.sex)),1)]),_:1}),t(s,{label:"状态","min-width":"100"},{default:n(({row:a})=>[t(pe,{type:a.status===1?"success":"danger"},{default:n(()=>[i(L(a.status_desc),1)]),_:2},1032,["type"])]),_:1}),t(s,{label:"最后登录",prop:"login_time","min-width":"160"}),t(s,{label:"创建时间",prop:"create_time","min-width":"160"}),t(s,{label:"操作",width:"200",fixed:"right"},{default:n(({row:a})=>[y((r(),d(p,{type:"primary",link:"",onClick:E=>ae(a)},{default:n(()=>e[14]||(e[14]=[i(" 编辑 ")])),_:2},1032,["onClick"])),[[g,["employee.employee/edit"]]]),y((r(),d(p,{type:"primary",link:"",onClick:E=>le(a)},{default:n(()=>e[15]||(e[15]=[i(" 改密 ")])),_:2},1032,["onClick"])),[[g,["employee.employee/password"]]]),a.status===1?y((r(),d(p,{key:0,type:"warning",link:"",onClick:E=>oe(a)},{default:n(()=>e[16]||(e[16]=[i(" 离职 ")])),_:2},1032,["onClick"])),[[g,["employee.employee/resign"]]]):y((r(),d(p,{key:1,type:"success",link:"",onClick:E=>ne(a)},{default:n(()=>e[17]||(e[17]=[i(" 恢复 ")])),_:2},1032,["onClick"])),[[g,["employee.employee/restore"]]]),y((r(),d(p,{type:"danger",link:"",onClick:E=>se(a)},{default:n(()=>e[18]||(e[18]=[i(" 删除 ")])),_:2},1032,["onClick"])),[[g,["employee.employee/delete"]]])]),_:1})]),_:1},8,["data"])),[[ye,o(b).loading]]),R("div",He,[t(_e,{modelValue:o(b),"onUpdate:modelValue":e[4]||(e[4]=a=>H(b)?b.value=a:null),onChange:o(_)},null,8,["modelValue","onChange"])])]),_:1}),o(C)?(r(),d(qe,{key:0,ref_key:"editRef",ref:T,onSuccess:o(_),onClose:e[5]||(e[5]=a=>C.value=!1)},null,8,["onSuccess"])):j("",!0),o(V)?(r(),d(je,{key:1,ref_key:"passwordRef",ref:M,onSuccess:o(_),onClose:e[6]||(e[6]=a=>V.value=!1)},null,8,["onSuccess"])):j("",!0),t(fe,{modelValue:o(v),"onUpdate:modelValue":e[10]||(e[10]=a=>H(v)?v.value=a:null),title:"离职转移",width:"520px"},{footer:n(()=>[t(p,{onClick:e[9]||(e[9]=a=>v.value=!1)},{default:n(()=>e[19]||(e[19]=[i("取消")])),_:1}),t(p,{type:"primary",loading:o($),onClick:ie},{default:n(()=>e[20]||(e[20]=[i(" 确认转移并离职 ")])),_:1},8,["loading"])]),default:n(()=>[R("div",Je," 需转移客户数："+L(o(D)),1),t(I,{"label-width":"100px"},{default:n(()=>[t(f,{label:"接手业务员",required:""},{default:n(()=>[t(F,{modelValue:o(u).to_uid,"onUpdate:modelValue":e[7]||(e[7]=a=>o(u).to_uid=a),placeholder:"请选择接手业务员",filterable:"",class:"w-full"},{default:n(()=>[(r(!0),h(A,null,G(o(P),a=>(r(),d(z,{key:a.id,label:re(a),value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(f,{label:"原因"},{default:n(()=>[t(x,{modelValue:o(u).reason,"onUpdate:modelValue":e[8]||(e[8]=a=>o(u).reason=a),type:"textarea",rows:3,maxlength:"255","show-word-limit":"",placeholder:"请输入转移原因"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});export{Ht as default};
