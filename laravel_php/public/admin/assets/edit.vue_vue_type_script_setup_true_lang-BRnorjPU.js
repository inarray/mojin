import{D as L,B as K,C as z,a8 as G,O as H,P as J,g as M}from"./element-plus-Dexv8m38.js";import{_ as Q}from"./picker-B75jrQ9B.js";import{d as W}from"./department-Csnz69ah.js";import{j as X}from"./post-Ctu21J9T.js";import{b as Y,a as Z,c as $}from"./blogger-Yc_pWcVi.js";import{r as h}from"./role-CHeEam9r.js";import{P as ee}from"./index-CiZ7u30k.js";import{u as le}from"./useDictOptions-C0oZ1YZn.js";import{m as U}from"./index-RwF53efZ.js";import{d as oe,s as j,r as ae,b as re,a0 as k,c as w,o as n,U as t,L as d,u as o,K as p,P as C,a as u,T as D,ab as R}from"./@vue-ygbFPFRc.js";const te={class:"edit-popup"},Ve=oe({__name:"edit",emits:["success","close"],setup(se,{expose:q,emit:B}){const V=B,v=j(),m=j(),f=ae("add"),A=re(()=>f.value=="edit"?"编辑博主":"新增博主"),l=k({id:"",account:"",name:"",dept_id:[],jobs_id:[],role_id:[4],avatar:"",password:"",password_confirm:"",disable:0,multipoint_login:1,root:0}),g=(s,e,r)=>{l.password&&(e||r(new Error("请再次输入密码")),e!==l.password&&r(new Error("两次输入密码不一致!"))),r()},_=k({account:[{required:!0,message:"请输入账号",trigger:["blur"]}],name:[{required:!0,message:"请输入名称",trigger:["blur"]}],role_id:[{required:!0,validator:(s,e,r)=>{l.root||l.role_id.length?r():r(new Error("请选择角色"))}}],password:[{required:!0,message:"请输入密码",trigger:["blur"]}],password_confirm:[{required:!0,message:"请输入确认密码",trigger:["blur"]},{validator:g,trigger:"blur"}]}),{optionsData:c}=le({role:{api:h,transformData:s=>s.filter(e=>e.id===4)},jobs:{api:X},dept:{api:W}}),F=async()=>{var e,r;await((e=v.value)==null?void 0:e.validate());const s={...l,role_id:[4]};s.password&&(s.password=U(s.password)),s.password_confirm&&(s.password_confirm=U(s.password_confirm)),f.value=="edit"?await Y(s):await Z(s),(r=m.value)==null||r.close(),V("success")},I=(s="add")=>{var e;f.value=s,(e=m.value)==null||e.open()},P=async s=>{_.password=[],_.password_confirm=[{validator:g,trigger:"blur"}];const e=await $({id:s.id});for(const r in l)e[r]!=null&&e[r]!=null&&(l[r]=e[r]);l.role_id=[4]},S=()=>{V("close")};return q({open:I,setFormData:P}),(s,e)=>{const r=z,i=K,N=Q,O=G,y=J,E=H,x=M,T=L;return n(),w("div",te,[t(ee,{ref_key:"popupRef",ref:m,title:o(A),async:!0,width:"550px",onConfirm:F,onClose:S},{default:d(()=>[t(T,{ref_key:"formRef",ref:v,model:o(l),"label-width":"84px",rules:o(_)},{default:d(()=>[t(i,{label:"账号",prop:"account"},{default:d(()=>[t(r,{modelValue:o(l).account,"onUpdate:modelValue":e[0]||(e[0]=a=>o(l).account=a),disabled:o(l).root==1,placeholder:"请输入账号",clearable:""},null,8,["modelValue","disabled"])]),_:1}),t(i,{label:"头像"},{default:d(()=>[u("div",null,[u("div",null,[t(N,{modelValue:o(l).avatar,"onUpdate:modelValue":e[1]||(e[1]=a=>o(l).avatar=a),limit:1},null,8,["modelValue"])]),e[10]||(e[10]=u("div",{class:"form-tips"},"建议尺寸：100*100px，支持jpg，jpeg，png格式",-1))])]),_:1}),t(i,{label:"名称",prop:"name"},{default:d(()=>[t(r,{modelValue:o(l).name,"onUpdate:modelValue":e[2]||(e[2]=a=>o(l).name=a),placeholder:"请输入名称",clearable:""},null,8,["modelValue"])]),_:1}),t(i,{label:"归属部门",prop:"dept_id"},{default:d(()=>[t(O,{class:"flex-1",modelValue:o(l).dept_id,"onUpdate:modelValue":e[3]||(e[3]=a=>o(l).dept_id=a),data:o(c).dept,clearable:"",multiple:"","node-key":"id",props:{value:"id",label:"name",disabled(a){return a.status!==1}},"check-strictly":"","default-expand-all":!0,placeholder:"请选择上级部门"},null,8,["modelValue","data","props"])]),_:1}),t(i,{label:"岗位",prop:"jobs_id"},{default:d(()=>[t(E,{class:"flex-1",modelValue:o(l).jobs_id,"onUpdate:modelValue":e[4]||(e[4]=a=>o(l).jobs_id=a),clearable:"",multiple:"",placeholder:"请选择岗位"},{default:d(()=>[(n(!0),w(D,null,R(o(c).jobs,(a,b)=>(n(),p(y,{key:b,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(l).root!=1?(n(),p(i,{key:0,label:"博主角色",prop:"role_id"},{default:d(()=>[t(E,{modelValue:o(l).role_id,"onUpdate:modelValue":e[5]||(e[5]=a=>o(l).role_id=a),disabled:!0,class:"flex-1",multiple:"",placeholder:"请选择角色"},{default:d(()=>[(n(!0),w(D,null,R(o(c).role,(a,b)=>(n(),p(y,{key:b,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):C("",!0),t(i,{label:"密码",prop:"password"},{default:d(()=>[t(r,{modelValue:o(l).password,"onUpdate:modelValue":e[6]||(e[6]=a=>o(l).password=a),"show-password":"",clearable:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(i,{label:"确认密码",prop:"password_confirm"},{default:d(()=>[t(r,{modelValue:o(l).password_confirm,"onUpdate:modelValue":e[7]||(e[7]=a=>o(l).password_confirm=a),"show-password":"",clearable:"",placeholder:"请输入确认密码"},null,8,["modelValue"])]),_:1}),o(l).root!=1?(n(),p(i,{key:1,label:"博主状态"},{default:d(()=>[t(x,{modelValue:o(l).disable,"onUpdate:modelValue":e[8]||(e[8]=a=>o(l).disable=a),"active-value":0,"inactive-value":1},null,8,["modelValue"])]),_:1})):C("",!0),t(i,{label:"多处登录"},{default:d(()=>[u("div",null,[t(x,{modelValue:o(l).multipoint_login,"onUpdate:modelValue":e[9]||(e[9]=a=>o(l).multipoint_login=a),"active-value":1,"inactive-value":0},null,8,["modelValue"]),e[11]||(e[11]=u("div",{class:"form-tips"},"允许多人同时在线登录",-1))])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])])}}});export{Ve as _};
