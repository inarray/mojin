import{a as w,E as I}from"./el-select-BSU4bs56.js";import{E as j}from"./el-tree-h27WeJsk.js";import{an as D,V as A,H as x,aw as S,ax as z,a5 as E,c as g,d as P,ae as F,af as q,c1 as U,aD as $,ek as G,ez as J,a9 as Q,bD as W,g as R,h as L,i as X,bx as T,ar as Y,ay as Z}from"./index-CAdEGE5y.js";import{i as ee}from"./isEqual-Uz2oXqxO.js";import{s as te}from"./token-DI9FKtlJ.js";const le=(e,{attrs:c,emit:u},{select:r,tree:s,key:a})=>{const f=D("tree-select");return A(()=>e.data,()=>{e.filterable&&x(()=>{var t,v;(v=s.value)==null||v.filter((t=r.value)==null?void 0:t.states.inputValue)})},{flush:"post"}),{...S(z(e),Object.keys(w.props)),...c,"onUpdate:modelValue":t=>u(E,t),valueKey:a,popperClass:g(()=>{const t=[f.e("popper")];return e.popperClass&&t.push(e.popperClass),t.join(" ")}),filterMethod:(t="")=>{var v;e.filterMethod?e.filterMethod(t):e.remoteMethod?e.remoteMethod(t):(v=s.value)==null||v.filter(t)}}},ne=P({extends:I,setup(e,c){const u=I.setup(e,c);delete u.selectOptionClick;const r=F().proxy;return x(()=>{u.select.states.cachedOptions.get(r.value)||u.select.onOptionCreate(r)}),A(()=>c.attrs.visible,s=>{u.states.visible=s},{immediate:!0}),u},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function H(e){return e||e===0}function p(e){return q(e)&&e.length}function b(e){return q(e)?e:H(e)?[e]:[]}function O(e,c,u,r,s){for(let a=0;a<e.length;a++){const f=e[a];if(c(f,a,e,s))return r?r(f,a,e,s):f;{const k=u(f);if(p(k)){const t=O(k,c,u,r,f);if(t)return t}}}}function M(e,c,u,r){for(let s=0;s<e.length;s++){const a=e[s];c(a,s,e,r);const f=u(a);p(f)&&M(f,c,u,a)}}const ae=(e,{attrs:c,slots:u,emit:r},{select:s,tree:a,key:f})=>{A(()=>e.modelValue,()=>{e.showCheckbox&&x(()=>{const l=a.value;l&&!ee(l.getCheckedKeys(),b(e.modelValue))&&l.setCheckedKeys(b(e.modelValue))})},{immediate:!0,deep:!0});const k=g(()=>({value:f.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf",...e.props})),t=(l,n)=>{var d;const o=k.value[l];return $(o)?o(n,(d=a.value)==null?void 0:d.getNode(t("value",n))):n[o]},v=b(e.modelValue).map(l=>O(e.data||[],n=>t("value",n)===l,n=>t("children",n),(n,d,o,h)=>h&&t("value",h))).filter(l=>H(l)),_=g(()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const l=[];return M(e.data.concat(e.cacheData),n=>{const d=t("value",n);l.push({value:d,currentLabel:t("label",n),isDisabled:t("disabled",n)})},n=>t("children",n)),l}),K=()=>{var l;return(l=a.value)==null?void 0:l.getCheckedKeys().filter(n=>{var d;const o=(d=a.value)==null?void 0:d.getNode(n);return!G(o)&&J(o.childNodes)})};return{...S(z(e),Object.keys(j.props)),...c,nodeKey:f,expandOnClickNode:g(()=>!e.checkStrictly&&e.expandOnClickNode),defaultExpandedKeys:g(()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(v):v),renderContent:(l,{node:n,data:d,store:o})=>l(ne,{value:t("value",d),label:t("label",d),disabled:t("disabled",d),visible:n.visible},e.renderContent?()=>e.renderContent(l,{node:n,data:d,store:o}):u.default?()=>u.default({node:n,data:d,store:o}):void 0),filterNodeMethod:(l,n,d)=>e.filterNodeMethod?e.filterNodeMethod(l,n,d):l?new RegExp(U(l),"i").test(t("label",n)||""):!0,onNodeClick:(l,n,d)=>{var o,h,C,m;if((o=c.onNodeClick)==null||o.call(c,l,n,d),!(e.showCheckbox&&e.checkOnClickNode)){if(!e.showCheckbox&&(e.checkStrictly||n.isLeaf)){if(!t("disabled",l)){const N=(h=s.value)==null?void 0:h.states.options.get(t("value",l));(C=s.value)==null||C.handleOptionSelect(N)}}else e.expandOnClickNode&&d.proxy.handleExpandIconClick();(m=s.value)==null||m.focus()}},onCheck:(l,n)=>{var d;if(!e.showCheckbox)return;const o=t("value",l),h={};M([a.value.store.root],i=>h[i.key]=i,i=>i.childNodes);const C=n.checkedKeys,m=e.multiple?b(e.modelValue).filter(i=>!(i in h)&&!C.includes(i)):[],N=m.concat(C);if(e.checkStrictly)r(E,e.multiple?N:N.includes(o)?o:void 0);else if(e.multiple){const i=K();r(E,m.concat(i))}else{const i=O([l],y=>!p(t("children",y))&&!t("disabled",y),y=>t("children",y)),V=i?t("value",i):void 0,B=H(e.modelValue)&&!!O([l],y=>t("value",y)===e.modelValue,y=>t("children",y));r(E,V===e.modelValue||B?void 0:V)}x(()=>{var i;const V=b(e.modelValue);a.value.setCheckedKeys(V),(i=c.onCheck)==null||i.call(c,l,{checkedKeys:a.value.getCheckedKeys(),checkedNodes:a.value.getCheckedNodes(),halfCheckedKeys:a.value.getHalfCheckedKeys(),halfCheckedNodes:a.value.getHalfCheckedNodes()})}),(d=s.value)==null||d.focus()},onNodeExpand:(l,n,d)=>{var o;(o=c.onNodeExpand)==null||o.call(c,l,n,d),x(()=>{if(!e.checkStrictly&&e.lazy&&e.multiple&&n.checked){const h={},C=a.value.getCheckedKeys();M([a.value.store.root],i=>h[i.key]=i,i=>i.childNodes);const m=b(e.modelValue).filter(i=>!(i in h)&&!C.includes(i)),N=K();r(E,m.concat(N))}})},cacheOptions:_}};var ce=P({props:{data:{type:Array,default:()=>[]}},setup(e){const c=Q(te);return A(()=>e.data,()=>{var u;e.data.forEach(s=>{c.states.cachedOptions.has(s.value)||c.states.cachedOptions.set(s.value,s)});const r=((u=c.selectRef)==null?void 0:u.querySelectorAll("input"))||[];W&&!Array.from(r).includes(document.activeElement)&&c.setSelected()},{flush:"post",immediate:!0}),()=>{}}});const se=P({name:"ElTreeSelect",inheritAttrs:!1,props:{...w.props,...j.props,cacheData:{type:Array,default:()=>[]}},setup(e,c){const{slots:u,expose:r}=c,s=R(),a=R(),f=g(()=>e.nodeKey||e.valueKey||"value"),k=le(e,c,{select:s,tree:a,key:f}),{cacheOptions:t,...v}=ae(e,c,{select:s,tree:a,key:f}),_=L({});return r(_),X(()=>{Object.assign(_,{...S(a.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"]),...S(s.value,["focus","blur","selectedLabel"])})}),()=>T(w,L({...k,ref:K=>s.value=K}),{...u,default:()=>[T(ce,{data:t.value}),T(j,L({...v,ref:K=>a.value=K}))]})}});var de=Y(se,[["__file","tree-select.vue"]]);const he=Z(de);export{he as E};
