import{D as ce,B as pe,C as _e,i as fe,I as ge,L as he,M as be,q as we,r as ve,d as ye,R as xe,K as Ce,S as ke,E as V}from"./element-plus-Dexv8m38.js";import{d as z,a0 as K,r as b,b as Ve,at as Ee,c as _,o as u,U as a,K as w,P as D,L as l,a9 as j,R as c,a as r,M as N,u as y,S as i,O as B,i as Te,n as Ie}from"./@vue-ygbFPFRc.js";import{K as Le}from"./@element-plus-X4lX9UBP.js";import{_ as De}from"./index.vue_vue_type_script_setup_true_lang-D_09Ie3h.js";import{u as Ne}from"./usePaging-B2jDzebD.js";import{r as q,a as Be,d as Fe}from"./index-RwF53efZ.js";import Me from"./follow-log-popup-Bt3e0Uw_.js";import"./lodash-es-C1lm3Iro.js";import"./dayjs-Bnps4p3p.js";import"./@popperjs-D_chPuIy.js";import"./async-validator-9PlIezaS.js";import"./@ctrl-r5W6hzzQ.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./nprogress-UhqZPtFR.js";import"./vue-router-Cg6aTb_d.js";import"./pinia-CfRoOCaL.js";import"./axios-DIsA03vz.js";import"./lodash-CMKdTQec.js";import"./@vueuse-yz9uDhpq.js";import"./css-color-function-rr4n3v1N.js";import"./balanced-match-BdS7OldZ.js";import"./color-DYO1E7y4.js";import"./clone-Ddk2tjDh.js";import"./color-convert-DsNsD289.js";import"./color-name-Dju3oUBS.js";import"./color-string-pUQDDJII.js";import"./ms-CzQ2E3wO.js";import"./vue-clipboard3-BWi338pc.js";import"./clipboard-7pJsftR6.js";import"./echarts-CXZcVnUo.js";import"./tslib-BDyQ-Jie.js";import"./zrender-DO4NV0px.js";import"./highlight.js-BLB-XFKK.js";import"./@highlightjs-DS9t1Xn3.js";import"./consumer-B-5sexIM.js";import"./index-CiZ7u30k.js";function Se(x){return q.get({url:"/customer/dedup/lists",params:x},{ignoreCancelToken:!0})}function Pe(x){return q.post({url:"/customer/dedup/createByMobile",params:x})}const Re={class:"customer-dedup"},Ue={class:"flex justify-between mb-4"},$e={class:"flex items-center"},Ke={class:"text-xs leading-5"},je={class:"font-bold text-sm"},ze={class:"text-gray-500"},qe={class:"text-gray-500"},Oe={class:"text-gray-500"},Ae={class:"text-gray-500"},Qe={class:"text-xs leading-5"},Ge={class:"owner-cell"},He={key:1},Je={key:1},We={key:0,class:"whitespace-pre-line"},Xe={key:1},Ye={key:0,class:"flex justify-end mt-4"},Ze=z({name:"customerDedup"}),et=z({...Ze,setup(x){const d=K({mobile:"",wechat:""}),f=b(!1),{pager:m,getLists:C}=Ne({fetchFun:Se,params:d}),g=b(!1),k=b(!1),p=K({wechat:""}),E=Be(),F=b(0),T=b(!1),M=b(),O=Ve(()=>{const t=E.userInfo||{};return Number(t.employee_user_id||t.user_id||0)}),A=()=>!!(d.mobile||d.wechat),I=async()=>{if(!A()){V.warning("请先输入查询条件");return}f.value=!0,m.page=1;try{await C()}catch{}},Q=()=>{d.mobile="",d.wechat="",f.value=!1,m.lists=[],m.count=0},G=()=>{g.value=!0},H=()=>{p.wechat="",k.value=!1},J=async()=>{if(!p.wechat.trim()){V.warning("请输入微信号");return}k.value=!0;try{await Pe({wechat:p.wechat}),V.success("创建成功"),d.wechat=p.wechat,g.value=!1,f.value=!0,m.page=1,await C()}catch(t){t!=null&&t.dedup_id&&(d.wechat=p.wechat,g.value=!1,f.value=!0,m.page=1,await C())}finally{k.value=!1}},W=t=>t===6?"stage-text stage-success":t===5||t===51?"stage-text stage-warning":t===4?"stage-text stage-info":"stage-text",S=t=>t==="urgent"?"remind-urgent":t==="near"?"remind-near":t==="normal"?"remind-normal":"",X=t=>t===1?"男":t===2?"女":"未知",Y=t=>{const o=t.last_follow_time_ts||0;if(!o)return"-";const n=Math.max(0,Math.floor(Date.now()/1e3)-o);return n<24*3600?`${Math.max(1,Math.floor(n/3600))}小时前`:n<48*3600?"昨天":t.last_follow_time||"-"},Z=t=>Number(t.follow_status||0)>0?"可联系":"暂不联系",ee=t=>Number(t.follow_status||0)>0?"success":"info",P=t=>{const o=O.value;return o?Number(t.transfer_from_employee_id||0)===o:!1},te=t=>{var o,n;return P(t)?t.transfer_from_name||((o=E.userInfo)==null?void 0:o.name)||((n=E.userInfo)==null?void 0:n.account)||t.owner_name||"-":t.owner_name||"-"},oe=t=>{const o=t.transfer_to_name||"",n=t.transfer_to_employee_id?`ID:${t.transfer_to_employee_id}`:"";return`已转给业务员【${o||n||"-"}】`},ae=t=>Number(t.owner_employee_id||0)>0,le=t=>{const o=Number(t.customer_id||0);if(!o){V.warning("该微信号暂无跟进记录");return}F.value=o,T.value=!0,Ie(()=>{var n;(n=M.value)==null||n.open("all")})};return(t,o)=>{const n=_e,v=pe,h=fe,R=ce,U=ge,s=be,se=we,ne=ve,re=ye,ie=xe,ue=he,de=ke,$=Ee("perms"),me=Ce;return u(),_("div",Re,[a(U,{class:"!border-none",shadow:"never"},{default:l(()=>[a(R,{inline:!0,model:d,class:"mb-[-16px]"},{default:l(()=>[a(v,{label:"手机号"},{default:l(()=>[a(n,{modelValue:d.mobile,"onUpdate:modelValue":o[0]||(o[0]=e=>d.mobile=e),placeholder:"请输入",clearable:"",class:"w-[200px]",onKeyup:j(I,["enter"])},null,8,["modelValue"])]),_:1}),a(v,{label:"微信号"},{default:l(()=>[a(n,{modelValue:d.wechat,"onUpdate:modelValue":o[1]||(o[1]=e=>d.wechat=e),placeholder:"请输入",clearable:"",class:"w-[200px]",onKeyup:j(I,["enter"])},null,8,["modelValue"])]),_:1}),a(v,null,{default:l(()=>[a(h,{type:"primary",onClick:I},{default:l(()=>o[7]||(o[7]=[c("查询")])),_:1}),a(h,{onClick:Q},{default:l(()=>o[8]||(o[8]=[c("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(U,{class:"mt-4 !border-none",shadow:"never"},{default:l(()=>[r("div",Ue,[N((u(),w(h,{type:"primary",onClick:G},{default:l(()=>o[9]||(o[9]=[c(" 录入微信号 ")])),_:1})),[[$,["customer/dedup/createByMobile"]]])]),N((u(),w(ue,{data:y(m).lists,size:"large","empty-text":f.value?"暂无数据":"请输入条件后查询"},{default:l(()=>[a(s,{label:"录入时间",prop:"create_time","min-width":"140"}),a(s,{label:"录入人",prop:"input_admin_name","min-width":"100"}),a(s,{label:"客户信息","min-width":"260"},{default:l(({row:e})=>[r("div",$e,[a(se,{size:48,src:e.avatar,class:"mr-2"},null,8,["src"]),r("div",Ke,[r("div",je,i(e.real_name||e.nickname||"-"),1),r("div",ze,"微信："+i(e.wechat||"-"),1),r("div",qe,"手机："+i(e.mobile||"-"),1),r("div",Oe,"性别："+i(X(e.sex)),1),r("div",Ae,"地区："+i(e.region||"-"),1)])])]),_:1}),a(s,{label:"来源","min-width":"140"},{default:l(({row:e})=>[r("div",Qe,[r("div",null,"来源："+i(e.source_desc||"-"),1),r("div",null,"来源账号："+i(e.source_account||"-"),1)])]),_:1}),a(s,{label:"客户类型",prop:"customer_type_desc","min-width":"90"}),a(s,{label:"主跟进人","min-width":"120"},{default:l(({row:e})=>[r("div",Ge,[r("span",null,i(te(e)),1),P(e)?(u(),w(ne,{key:0,content:oe(e)},{default:l(()=>o[10]||(o[10]=[r("span",{class:"owner-transfer"},"（转）",-1)])),_:2},1032,["content"])):D("",!0)])]),_:1}),a(s,{label:"协助员","min-width":"120"},{default:l(({row:e})=>{var L;return[c(i(((L=e.assist_names)==null?void 0:L.join(", "))||"-"),1)]}),_:1}),a(s,{label:"平台咨询",prop:"blogger_name","min-width":"100"}),a(s,{label:"提醒","min-width":"70"},{default:l(({row:e})=>[e.next_follow_time?(u(),w(re,{key:0,class:B(["remind-icon",S(e.remind_status)])},{default:l(()=>[a(y(Le))]),_:2},1032,["class"])):(u(),_("span",He,"-"))]),_:1}),a(s,{label:"客户阶段","min-width":"90"},{default:l(({row:e})=>[ae(e)?(u(),_("span",{key:0,class:B(W(e.stage))},i(e.stage_desc),3)):(u(),_("span",Je,"-"))]),_:1}),a(s,{label:"报单项目",prop:"project_items_desc","min-width":"140","show-overflow-tooltip":""}),a(s,{label:"所在群聊","min-width":"120"},{default:l(({row:e})=>[e.group_chat?(u(),_("span",We,i(e.group_chat),1)):(u(),_("span",Xe,"-"))]),_:1}),a(s,{label:"所推咨询",prop:"hospital","min-width":"140","show-overflow-tooltip":""},{default:l(({row:e})=>[c(i(e.hospital||"-"),1)]),_:1}),a(s,{label:"下次跟进时间","min-width":"140"},{default:l(({row:e})=>[r("span",{class:B(S(e.remind_status))},i(e.next_follow_time||"-"),3)]),_:1}),a(s,{label:"最后跟进时间","min-width":"140"},{default:l(({row:e})=>[c(i(Y(e)),1)]),_:1}),a(s,{label:"能否联系","min-width":"140"},{default:l(({row:e})=>[a(ie,{type:ee(e)},{default:l(()=>[c(i(Z(e)),1)]),_:2},1032,["type"])]),_:1}),a(s,{label:"操作",width:"160",fixed:"right"},{default:l(({row:e})=>[N((u(),w(h,{type:"primary",plain:"",size:"small",disabled:!e.customer_id,onClick:L=>le(e)},{default:l(()=>o[11]||(o[11]=[c(" 查看跟进记录 ")])),_:2},1032,["disabled","onClick"])),[[$,["user.user/detail"]]])]),_:1})]),_:1},8,["data","empty-text"])),[[me,y(m).loading]]),f.value?(u(),_("div",Ye,[a(De,{modelValue:y(m),"onUpdate:modelValue":o[2]||(o[2]=e=>Te(m)?m.value=e:null),onChange:y(C)},null,8,["modelValue","onChange"])])):D("",!0)]),_:1}),T.value?(u(),w(Me,{key:0,ref_key:"followLogPopupRef",ref:M,"customer-id":F.value,onClose:o[3]||(o[3]=e=>T.value=!1)},null,8,["customer-id"])):D("",!0),a(de,{modelValue:g.value,"onUpdate:modelValue":o[6]||(o[6]=e=>g.value=e),title:"录入微信号",width:"420px",onClose:H},{footer:l(()=>[a(h,{onClick:o[5]||(o[5]=e=>g.value=!1)},{default:l(()=>o[12]||(o[12]=[c("取消")])),_:1}),a(h,{type:"primary",loading:k.value,onClick:J},{default:l(()=>o[13]||(o[13]=[c("确认")])),_:1},8,["loading"])]),default:l(()=>[a(R,{model:p,"label-width":"80px"},{default:l(()=>[a(v,{label:"微信号"},{default:l(()=>[a(n,{modelValue:p.wechat,"onUpdate:modelValue":o[4]||(o[4]=e=>p.wechat=e),maxlength:"50",placeholder:"请输入微信号"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Rt=Fe(et,[["__scopeId","data-v-bbeadd09"]]);export{Rt as default};
