import{D as B,J as D,B as F,C as P,O as I,P as N,E as _}from"./element-plus-Dexv8m38.js";import{c as $,d as q,g as L}from"./report-Dk0xVeLs.js";import{P as S}from"./index-CiZ7u30k.js";import{d as A,r as c,a0 as J,K as f,o as p,L as n,U as r,u as o,P as K,c as M,T,ab as z}from"./@vue-ygbFPFRc.js";const Y=A({__name:"report-popup",emits:["success","close"],setup(G,{expose:h,emit:k}){const b=k,d=c(),i=c(),e=J({mobile:"",wechat:"",real_name:"",source:"",source_account:"",region:"",project_items:"",remark:""}),v={mobile:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"手机号格式不正确",trigger:"blur"}],wechat:[{required:!0,message:"请输入微信号",trigger:"blur"}]},V=c({}),s=c(null),y=async()=>{try{const a=await L();V.value=a.source_options||{}}catch(a){console.error(a)}},x=async()=>{if(!e.mobile||e.mobile.length<11){s.value=null;return}try{const a=await $({mobile:e.mobile});a.exists?s.value=a.report:s.value=null}catch(a){console.error(a)}},E=()=>{var a;(a=d.value)==null||a.open(),y()},U=async()=>{var a;if(await((a=i.value)==null?void 0:a.validate()),s.value){_.warning("该手机号已存在线索，无需重复报备");return}try{await q(e),_.success("报备成功"),b("success"),g()}catch(l){_.error(l.msg||"报备失败")}},g=()=>{var a,l;(a=i.value)==null||a.resetFields(),s.value=null,Object.assign(e,{mobile:"",wechat:"",real_name:"",source:"",source_account:"",region:"",project_items:"",remark:""}),(l=d.value)==null||l.close(),b("close")};return h({open:E}),(a,l)=>{const C=D,m=P,u=F,j=N,O=I,R=B;return p(),f(S,{ref_key:"popupRef",ref:d,title:"客户报备",async:!0,width:"600px",onConfirm:U,onClose:g},{default:n(()=>[r(R,{ref_key:"formRef",ref:i,model:o(e),rules:v,"label-width":"100px"},{default:n(()=>[o(s)?(p(),f(C,{key:0,title:`该手机号已存在线索，负责人：${o(s).owner_name}，阶段：${o(s).stage_desc}`,type:"warning",closable:!1,"show-icon":"",class:"mb-4"},null,8,["title"])):K("",!0),r(u,{label:"手机号",prop:"mobile"},{default:n(()=>[r(m,{modelValue:o(e).mobile,"onUpdate:modelValue":l[0]||(l[0]=t=>o(e).mobile=t),placeholder:"请输入手机号",maxlength:"11",onBlur:x},null,8,["modelValue"])]),_:1}),r(u,{label:"微信号",prop:"wechat"},{default:n(()=>[r(m,{modelValue:o(e).wechat,"onUpdate:modelValue":l[1]||(l[1]=t=>o(e).wechat=t),placeholder:"请输入微信号"},null,8,["modelValue"])]),_:1}),r(u,{label:"客户姓名",prop:"real_name"},{default:n(()=>[r(m,{modelValue:o(e).real_name,"onUpdate:modelValue":l[2]||(l[2]=t=>o(e).real_name=t),placeholder:"请输入客户姓名"},null,8,["modelValue"])]),_:1}),r(u,{label:"客户来源",prop:"source"},{default:n(()=>[r(O,{modelValue:o(e).source,"onUpdate:modelValue":l[3]||(l[3]=t=>o(e).source=t),placeholder:"请选择来源",clearable:"",class:"w-full"},{default:n(()=>[(p(!0),M(T,null,z(o(V),(t,w)=>(p(),f(j,{key:w,label:t,value:Number(w)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(u,{label:"来源账号",prop:"source_account"},{default:n(()=>[r(m,{modelValue:o(e).source_account,"onUpdate:modelValue":l[4]||(l[4]=t=>o(e).source_account=t),placeholder:"请输入来源账号（如抖音号）"},null,8,["modelValue"])]),_:1}),r(u,{label:"客户地区",prop:"region"},{default:n(()=>[r(m,{modelValue:o(e).region,"onUpdate:modelValue":l[5]||(l[5]=t=>o(e).region=t),placeholder:"请输入客户所在地区"},null,8,["modelValue"])]),_:1}),r(u,{label:"意向项目",prop:"project_items"},{default:n(()=>[r(m,{modelValue:o(e).project_items,"onUpdate:modelValue":l[6]||(l[6]=t=>o(e).project_items=t),placeholder:"请输入意向项目"},null,8,["modelValue"])]),_:1}),r(u,{label:"备注",prop:"remark"},{default:n(()=>[r(m,{modelValue:o(e).remark,"onUpdate:modelValue":l[7]||(l[7]=t=>o(e).remark=t),type:"textarea",rows:3,placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},512)}}});export{Y as _};
