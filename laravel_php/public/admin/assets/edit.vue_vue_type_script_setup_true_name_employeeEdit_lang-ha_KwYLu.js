import{P as G}from"./index-CiZ7u30k.js";import{D as I,B as L,C as Z,a8 as $,O as H,P as K,G as M,H as J,E as Q}from"./element-plus-Dexv8m38.js";import{_ as W}from"./picker-B75jrQ9B.js";import{d as X}from"./department-Csnz69ah.js";import{j as Y}from"./post-Ctu21J9T.js";import{r as ee}from"./role-CHeEam9r.js";import{a as ae,b as le,e as oe}from"./employee-CJ8eLApb.js";import{u as te}from"./useDictOptions-C0oZ1YZn.js";import{m as re}from"./index-RwF53efZ.js";import{d as C,r as f,b as j,a0 as de,K as u,o as m,u as l,L as d,U as r,P as E,c as g,T as U,ab as R,R as x}from"./@vue-ygbFPFRc.js";const se={key:0,class:"text-xs text-gray-400 mt-1"},ne=C({name:"employeeEdit"}),ve=C({...ne,emits:["success","close"],setup(ie,{expose:q,emit:A}){const V=A,p=f(),v=f(),s=f("add"),D=j(()=>s.value==="add"?"添加业务员":"编辑业务员"),e=de({id:0,account:"",password:"",real_name:"",nickname:"",mobile:"",dept_id:"",jobs_id:"",role_id:"",sex:0,avatar:""}),{optionsData:_}=te({role:{api:ee},jobs:{api:Y},dept:{api:X}}),P=j(()=>({account:[{required:s.value==="add",message:"请输入账号",trigger:"blur"},{min:4,max:32,message:"账号长度4-32个字符",trigger:"blur"},{pattern:/^(?:[a-zA-Z][a-zA-Z0-9_]*|\d+)$/,message:"账号只能由字母、数字、下划线组成，或纯数字",trigger:"blur"}],password:[{required:s.value==="add",message:"请输入密码",trigger:"blur"},{min:6,max:32,message:"密码长度6-32个字符",trigger:"blur"}],mobile:[{required:!0,message:"请输入手机号码",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"手机号码格式错误",trigger:"blur"}],dept_id:[{required:!0,message:"请选择归属部门",trigger:"change"}],jobs_id:[{required:!0,message:"请选择岗位",trigger:"change"}],role_id:[{required:!0,message:"请选择角色",trigger:"change"}]})),B=()=>{e.id=0,e.account="",e.password="",e.real_name="",e.nickname="",e.mobile="",e.dept_id="",e.jobs_id="",e.role_id="",e.sex=0,e.avatar=""},F=async(n,a)=>{var i;if(s.value=n,B(),(i=p.value)==null||i.open(),n==="edit"&&a)try{const t=await ae({id:a});e.id=t.id,e.account=t.account,e.real_name=t.real_name||"",e.nickname=t.nickname||"",e.mobile=t.mobile||"",e.dept_id=t.dept_id||"",e.jobs_id=t.jobs_id||"",e.role_id=t.role_id||"",e.sex=typeof t.sex=="string"?0:t.sex,e.avatar=t.avatar||""}catch(t){console.error(t)}},T=async()=>{var n;try{await((n=v.value)==null?void 0:n.validate()),s.value==="add"?await le({account:e.account,password:re(e.password),real_name:e.real_name,nickname:e.nickname,mobile:e.mobile,dept_id:e.dept_id,jobs_id:e.jobs_id,role_id:e.role_id,sex:e.sex,avatar:e.avatar}):await oe({id:e.id,real_name:e.real_name,nickname:e.nickname,mobile:e.mobile,dept_id:e.dept_id,jobs_id:e.jobs_id,role_id:e.role_id,sex:e.sex,avatar:e.avatar}),Q.success(s.value==="add"?"添加成功":"编辑成功"),V("success"),k()}catch(a){return Promise.reject(a)}},k=()=>{var n;(n=p.value)==null||n.close(),V("close")};return q({open:F}),(n,a)=>{const i=Z,t=L,h=$,w=K,y=H,c=J,N=M,O=W,S=I,z=G;return m(),u(z,{ref_key:"popupRef",ref:p,title:l(D),async:!0,width:"500px",onConfirm:T,onClose:k},{default:d(()=>[r(S,{ref_key:"formRef",ref:v,model:l(e),rules:l(P),"label-width":"100px","label-position":"right"},{default:d(()=>[r(t,{label:"账号",prop:"account"},{default:d(()=>[r(i,{modelValue:l(e).account,"onUpdate:modelValue":a[0]||(a[0]=o=>l(e).account=o),placeholder:"请输入登录账号",disabled:l(s)==="edit",maxlength:"32","show-word-limit":""},null,8,["modelValue","disabled"]),l(s)==="add"?(m(),g("div",se," 账号可为手机号或字母数字下划线 ")):E("",!0)]),_:1}),l(s)==="add"?(m(),u(t,{key:0,label:"密码",prop:"password"},{default:d(()=>[r(i,{modelValue:l(e).password,"onUpdate:modelValue":a[1]||(a[1]=o=>l(e).password=o),type:"password",placeholder:"请输入登录密码",maxlength:"32","show-password":""},null,8,["modelValue"])]),_:1})):E("",!0),r(t,{label:"真实姓名",prop:"real_name"},{default:d(()=>[r(i,{modelValue:l(e).real_name,"onUpdate:modelValue":a[2]||(a[2]=o=>l(e).real_name=o),placeholder:"请输入真实姓名",maxlength:"32"},null,8,["modelValue"])]),_:1}),r(t,{label:"昵称",prop:"nickname"},{default:d(()=>[r(i,{modelValue:l(e).nickname,"onUpdate:modelValue":a[3]||(a[3]=o=>l(e).nickname=o),placeholder:"请输入昵称",maxlength:"32"},null,8,["modelValue"])]),_:1}),r(t,{label:"手机号码",prop:"mobile"},{default:d(()=>[r(i,{modelValue:l(e).mobile,"onUpdate:modelValue":a[4]||(a[4]=o=>l(e).mobile=o),placeholder:"请输入手机号码",maxlength:"11"},null,8,["modelValue"])]),_:1}),r(t,{label:"归属部门",prop:"dept_id"},{default:d(()=>[r(h,{class:"flex-1",modelValue:l(e).dept_id,"onUpdate:modelValue":a[5]||(a[5]=o=>l(e).dept_id=o),data:l(_).dept,clearable:"","node-key":"id",props:{value:"id",label:"name",disabled(o){return o.status!==1}},"check-strictly":"","default-expand-all":!0,placeholder:"请选择归属部门"},null,8,["modelValue","data","props"])]),_:1}),r(t,{label:"岗位",prop:"jobs_id"},{default:d(()=>[r(y,{class:"flex-1",modelValue:l(e).jobs_id,"onUpdate:modelValue":a[6]||(a[6]=o=>l(e).jobs_id=o),clearable:"",placeholder:"请选择岗位"},{default:d(()=>[(m(!0),g(U,null,R(l(_).jobs,(o,b)=>(m(),u(w,{key:b,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(t,{label:"角色",prop:"role_id"},{default:d(()=>[r(y,{modelValue:l(e).role_id,"onUpdate:modelValue":a[7]||(a[7]=o=>l(e).role_id=o),class:"flex-1",placeholder:"请选择角色",clearable:""},{default:d(()=>[(m(!0),g(U,null,R(l(_).role,(o,b)=>(m(),u(w,{key:b,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(t,{label:"性别",prop:"sex"},{default:d(()=>[r(N,{modelValue:l(e).sex,"onUpdate:modelValue":a[8]||(a[8]=o=>l(e).sex=o)},{default:d(()=>[r(c,{value:0},{default:d(()=>a[10]||(a[10]=[x("未知")])),_:1}),r(c,{value:1},{default:d(()=>a[11]||(a[11]=[x("男")])),_:1}),r(c,{value:2},{default:d(()=>a[12]||(a[12]=[x("女")])),_:1})]),_:1},8,["modelValue"])]),_:1}),r(t,{label:"头像",prop:"avatar"},{default:d(()=>[r(O,{modelValue:l(e).avatar,"onUpdate:modelValue":a[9]||(a[9]=o=>l(e).avatar=o),limit:1},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])}}});export{ve as _};
