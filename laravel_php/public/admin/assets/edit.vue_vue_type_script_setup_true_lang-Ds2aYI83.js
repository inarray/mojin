import{D as K,B as z,C as G,a8 as H,O as J,P as M,g as Q}from"./element-plus-Dexv8m38.js";import{_ as W}from"./picker-B75jrQ9B.js";import{d as X}from"./department-Csnz69ah.js";import{j as Y}from"./post-Ctu21J9T.js";import{r as m,m as k}from"./index-RwF53efZ.js";import{r as Z}from"./role-CHeEam9r.js";import{P as $}from"./index-CiZ7u30k.js";import{u as ee}from"./useDictOptions-C0oZ1YZn.js";import{d as le,s as C,r as oe,b as ae,a0 as D,c as v,o as u,U as r,L as d,u as o,K as f,P as q,a as p,T as R,ab as B}from"./@vue-ygbFPFRc.js";function Ve(n){return m.get({url:"/auth.admin/lists",params:n},{ignoreCancelToken:!0})}function te(n){return m.post({url:"/auth.admin/add",params:n})}function re(n){return m.post({url:"/auth.admin/edit",params:n})}function ve(n){return m.post({url:"/auth.admin/delete",params:n})}function se(n){return m.get({url:"/auth.admin/detail",params:n})}const de={class:"edit-popup"},ge=le({__name:"edit",emits:["success","close"],setup(n,{expose:A,emit:F}){const g=F,y=C(),c=C(),_=oe("add"),I=ae(()=>_.value=="edit"?"编辑管理员":"新增管理员"),l=D({id:"",account:"",name:"",dept_id:[],jobs_id:[],role_id:[],avatar:"",password:"",password_confirm:"",disable:0,multipoint_login:1,root:0}),E=(s,e,t)=>{l.password&&(e||t(new Error("请再次输入密码")),e!==l.password&&t(new Error("两次输入密码不一致!"))),t()},b=D({account:[{required:!0,message:"请输入账号",trigger:["blur"]}],name:[{required:!0,message:"请输入名称",trigger:["blur"]}],role_id:[{required:!0,validator:(s,e,t)=>{l.root||l.role_id.length?t():t(new Error("请选择角色"))}}],password:[{required:!0,message:"请输入密码",trigger:["blur"]}],password_confirm:[{required:!0,message:"请输入确认密码",trigger:["blur"]},{validator:E,trigger:"blur"}]}),{optionsData:w}=ee({role:{api:Z},jobs:{api:Y},dept:{api:X}}),P=async()=>{var e,t;await((e=y.value)==null?void 0:e.validate());const s={...l};s.password&&(s.password=k(s.password)),s.password_confirm&&(s.password_confirm=k(s.password_confirm)),_.value=="edit"?await re(s):await te(s),(t=c.value)==null||t.close(),g("success")},S=(s="add")=>{var e;_.value=s,(e=c.value)==null||e.open()},T=async s=>{b.password=[],b.password_confirm=[{validator:E,trigger:"blur"}];const e=await se({id:s.id});for(const t in l)e[t]!=null&&e[t]!=null&&(l[t]=e[t])},L=()=>{g("close")};return A({open:S,setFormData:T}),(s,e)=>{const t=G,i=z,N=W,O=H,x=M,U=J,j=Q,h=K;return u(),v("div",de,[r($,{ref_key:"popupRef",ref:c,title:o(I),async:!0,width:"550px",onConfirm:P,onClose:L},{default:d(()=>[r(h,{ref_key:"formRef",ref:y,model:o(l),"label-width":"84px",rules:o(b)},{default:d(()=>[r(i,{label:"账号",prop:"account"},{default:d(()=>[r(t,{modelValue:o(l).account,"onUpdate:modelValue":e[0]||(e[0]=a=>o(l).account=a),disabled:o(l).root==1,placeholder:"请输入账号",clearable:""},null,8,["modelValue","disabled"])]),_:1}),r(i,{label:"头像"},{default:d(()=>[p("div",null,[p("div",null,[r(N,{modelValue:o(l).avatar,"onUpdate:modelValue":e[1]||(e[1]=a=>o(l).avatar=a),limit:1},null,8,["modelValue"])]),e[10]||(e[10]=p("div",{class:"form-tips"},"建议尺寸：100*100px，支持jpg，jpeg，png格式",-1))])]),_:1}),r(i,{label:"名称",prop:"name"},{default:d(()=>[r(t,{modelValue:o(l).name,"onUpdate:modelValue":e[2]||(e[2]=a=>o(l).name=a),placeholder:"请输入名称",clearable:""},null,8,["modelValue"])]),_:1}),r(i,{label:"归属部门",prop:"dept_id"},{default:d(()=>[r(O,{class:"flex-1",modelValue:o(l).dept_id,"onUpdate:modelValue":e[3]||(e[3]=a=>o(l).dept_id=a),data:o(w).dept,clearable:"",multiple:"","node-key":"id",props:{value:"id",label:"name",disabled(a){return a.status!==1}},"check-strictly":"","default-expand-all":!0,placeholder:"请选择上级部门"},null,8,["modelValue","data","props"])]),_:1}),r(i,{label:"岗位",prop:"jobs_id"},{default:d(()=>[r(U,{class:"flex-1",modelValue:o(l).jobs_id,"onUpdate:modelValue":e[4]||(e[4]=a=>o(l).jobs_id=a),clearable:"",multiple:"",placeholder:"请选择岗位"},{default:d(()=>[(u(!0),v(R,null,B(o(w).jobs,(a,V)=>(u(),f(x,{key:V,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(l).root!=1?(u(),f(i,{key:0,label:"角色",prop:"role_id"},{default:d(()=>[r(U,{modelValue:o(l).role_id,"onUpdate:modelValue":e[5]||(e[5]=a=>o(l).role_id=a),disabled:o(l).root==1,class:"flex-1",multiple:"",placeholder:"请选择角色",clearable:""},{default:d(()=>[(u(!0),v(R,null,B(o(w).role,(a,V)=>(u(),f(x,{key:V,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})):q("",!0),r(i,{label:"密码",prop:"password"},{default:d(()=>[r(t,{modelValue:o(l).password,"onUpdate:modelValue":e[6]||(e[6]=a=>o(l).password=a),"show-password":"",clearable:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),r(i,{label:"确认密码",prop:"password_confirm"},{default:d(()=>[r(t,{modelValue:o(l).password_confirm,"onUpdate:modelValue":e[7]||(e[7]=a=>o(l).password_confirm=a),"show-password":"",clearable:"",placeholder:"请输入确认密码"},null,8,["modelValue"])]),_:1}),o(l).root!=1?(u(),f(i,{key:1,label:"管理员状态"},{default:d(()=>[r(j,{modelValue:o(l).disable,"onUpdate:modelValue":e[8]||(e[8]=a=>o(l).disable=a),"active-value":0,"inactive-value":1},null,8,["modelValue"])]),_:1})):q("",!0),r(i,{label:"多处登录"},{default:d(()=>[p("div",null,[r(j,{modelValue:o(l).multipoint_login,"onUpdate:modelValue":e[9]||(e[9]=a=>o(l).multipoint_login=a),"active-value":1,"inactive-value":0},null,8,["modelValue"]),e[11]||(e[11]=p("div",{class:"form-tips"},"允许多人同时在线登录",-1))])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])])}}});export{ge as _,Ve as a,re as b,ve as c};
